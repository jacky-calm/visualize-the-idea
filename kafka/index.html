<!DOCTYPE html>
<html>
<head>
    <title>Vizit</title>
    <script src="node_modules/@svgdotjs/svg.js/dist/svg.js"></script>
    <script src="node_modules/@svgdotjs/svg.draggable.js/dist/svg.draggable.js"></script>
    <!--    <script data-main="scripts/main" src="scripts/require.js"></script>-->
    <script src="node_modules/svg.draggy.js/src/svg.draggy.js"></script>
    <script src="node_modules/jquery/dist/jquery.js"></script>
</head>
<body>

<script>
    let version = Date.now();

    function createNode(container, data) {
        console.log(data);
        let group = container.group()
            .transform({translateX: data.group.transform.translateX, translateY: data.group.transform.translateY})
            .id(data.group.id);
        let style = {fill: 'none', stroke: 'blue'};
        let attributes = {...style, ...data.shape.attributes};
        let rect = container[data.shape.type](data.group.id.length * 11, 28).attr(attributes);
        group.add(rect);

        let label = container.text(data.label.text);
        label.attr(data.label.attributes);
        group.add(label);
        return group.draggy();
    }

    function createPath(container, data, marker) {
        container.path(data.data).id(data.id)
            .fill('blue')
            .stroke({width: 1, color: 'blue'})
            .marker('end', marker);
    }

    let svg = SVG().addTo('body').attr({width: 1000, height: 800});
    SVG.on(document, 'DOMContentLoaded', function () {
        $.getJSON("data/brokers.json?"+version, function (data) {
            data.forEach(node => createNode(svg, node))
        });

        $.getJSON("data/zookeeper.json?"+version, function (data) {
            data.forEach(node => createNode(svg, node))
        });

        let marker = svg.marker(13, 13, function (add) {
            add.path('M2,2 L2,11 L10,6 L2,2').fill('blue').stroke({width: 1, color: 'blue'})
        }).attr({"refX": "2", "refY": "6", "orient": "auto"});



        $.getJSON("data/paths.json?"+version, function (data) {
            data.forEach(node => createPath(svg, node, marker))
        });
        console.log(svg);
        // svg.findOne("#path-broker1-zookeeper").animate(2000, 1000, 'now').attr({ fill: '#f03' })
        // "data": "M 200, 230 L 390, 310"
        let circle1 = svg.circle(20).attr({cx: 200, cy:230}).fill('green').animate(2000, 100, 'now').move(380, 300);
        // "data": "M 520, 310 L 680, 230"
        let circle2 = svg.circle(20).attr({cx: 520, cy:310}).fill('green').animate(2000, 2000, 'after').move(670, 220);

    })
</script>
</body>
</html>